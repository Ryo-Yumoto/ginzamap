<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>DT Map in Ginza</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      /* Palette */
      --white:      #FFFFFF;
      --off-white:  #F5F5F7;
      --surface:    #FBFBFD;
      --divider:    rgba(0,0,0,.08);
      --text-1:     #1D1D1F;
      --text-2:     #6E6E73;
      --text-3:     #AEAEB2;
      --gold:       #B8943F;
      --gold-lt:    #D4AF66;
      --gold-bg:    #FBF7EE;

      /* Category accent colours (muted, editorial) */
      --c-bar:      #4A3728;
      --c-club:     #2C2C3E;
      --c-lounge:   #1C3A2E;
      --c-jazz:     #3B2035;
      --c-wine:     #5C1E2D;
      --c-hostess:  #1A2F4A;

      /* Geometry */
      --r-sm:  8px;
      --r-md:  14px;
      --r-lg:  20px;
      --r-xl:  28px;

      /* Motion */
      --ease:  cubic-bezier(.4,0,.2,1);
      --dur:   .22s;

      /* Shadows â€” Apple-style diffuse */
      --s-sm:  0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
      --s-md:  0 4px 16px rgba(0,0,0,.08), 0 1px 4px rgba(0,0,0,.04);
      --s-lg:  0 12px 40px rgba(0,0,0,.12), 0 2px 8px rgba(0,0,0,.06);
      --s-xl:  0 24px 64px rgba(0,0,0,.14), 0 4px 16px rgba(0,0,0,.06);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESET
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      background: var(--off-white);
      color: var(--text-1);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LAYOUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #app {
      position: relative;
      height: 100dvh;
      /* NO overflow:hidden â€” ãã‚ŒãŒã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ»detailã‚’ã‚¯ãƒªãƒƒãƒ—ã™ã‚‹åŸå›  */
    }
    #map {
      position: absolute;
      inset: 0;
      z-index: 1;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PANEL â€” single element, two states
       Normal  : full sidebar (340px wide, full height)
       Minimized: collapses to 44Ã—44 button in-place
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #panel {
      position: absolute;
      top: 20px;
      left: 20px;
      /* full state dimensions */
      width: 340px;
      bottom: 20px;
      display: flex;
      flex-direction: column;
      background: rgba(255,255,255,.96);
      backdrop-filter: saturate(180%) blur(24px);
      -webkit-backdrop-filter: saturate(180%) blur(24px);
      border-radius: 20px;
      border: 1px solid var(--divider);
      box-shadow: var(--s-xl);
      z-index: 1000;
      overflow: hidden;
      cursor: default;
      /* animate width, height (bottom), border-radius together */
      transition:
        width  .38s cubic-bezier(.4,0,.2,1),
        bottom .38s cubic-bezier(.4,0,.2,1),
        border-radius .38s cubic-bezier(.4,0,.2,1),
        box-shadow .38s cubic-bezier(.4,0,.2,1);
    }

    /* Minimized: shrink to 44Ã—44 pill in the top-left corner */
    #panel.minimized {
      width: 44px;
      bottom: calc(100% - 20px - 44px); /* top:20px + height:44px */
      border-radius: 14px;
      box-shadow: var(--s-md);
      cursor: pointer;
      overflow: hidden;
    }
    #panel.minimized:hover {
      background: var(--off-white);
    }

    /* Full content â€” shown in normal state, hidden when minimized */
    #panel-content {
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
      /* fade out quickly when minimizing */
      transition: opacity .2s cubic-bezier(.4,0,.2,1);
      opacity: 1;
    }
    #panel.minimized #panel-content {
      opacity: 0;
      pointer-events: none;
    }

    /* Mini icon (â˜°) â€” hidden in normal state, shown when minimized */
    #panel-mini {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--text-1);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s cubic-bezier(.4,0,.2,1) .18s; /* delay = after shrink starts */
    }
    #panel.minimized #panel-mini {
      opacity: 1;
      pointer-events: auto;
    }

    /* â”€â”€ Sidebar top bar with minimize button â”€â”€ */
    #sidebar-topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px 0;
      flex-shrink: 0;
    }
    #sidebar-minimize {
      width: 30px; height: 30px;
      border-radius: 50%;
      border: none;
      background: var(--off-white);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-2);
      font-size: 16px;
      line-height: 1;
      transition: background var(--dur) var(--ease);
      flex-shrink: 0;
    }
    #sidebar-minimize:hover { background: var(--divider); }

    /* â”€â”€ Wordmark / Header â”€â”€ */
    #header {
      padding: 10px 24px 16px;
      border-bottom: 1px solid var(--divider);
      flex-shrink: 0;
    }
    .wordmark {
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 10px;
    }
    .wordmark-main {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -.03em;
      color: var(--text-1);
    }
    .wordmark-sub {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--gold);
    }
    .header-desc {
      font-size: 12px;
      line-height: 1.6;
      color: var(--text-2);
      max-width: 300px;
    }

    /* â”€â”€ Search â”€â”€ */
    #search-wrap {
      padding: 12px 16px;
      border-bottom: 1px solid var(--divider);
      flex-shrink: 0;
    }
    .search-field {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--off-white);
      border-radius: 10px;
      padding: 0 12px;
      border: 1px solid transparent;
      transition: border-color var(--dur) var(--ease), background var(--dur) var(--ease);
    }
    .search-field:focus-within {
      border-color: var(--gold);
      background: var(--white);
      box-shadow: 0 0 0 3px rgba(184,148,63,.1);
    }
    .search-icon { color: var(--text-3); font-size: 14px; flex-shrink: 0; }
    #search {
      width: 100%;
      padding: 10px 0;
      border: none;
      background: transparent;
      font-size: 13px;
      font-family: inherit;
      color: var(--text-1);
      outline: none;
    }
    #search::placeholder { color: var(--text-3); }

    /* â”€â”€ Category Pills â”€â”€ */
    #filters {
      padding: 12px 16px 10px;
      display: flex;
      gap: 6px;
      overflow-x: auto;
      scrollbar-width: none;
      border-bottom: 1px solid var(--divider);
      flex-shrink: 0;
    }
    #filters::-webkit-scrollbar { display: none; }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 6px 13px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      border: 1px solid var(--divider);
      background: var(--white);
      color: var(--text-2);
      transition: all var(--dur) var(--ease);
      user-select: none;
      letter-spacing: -.01em;
    }
    .pill:hover { border-color: var(--gold-lt); color: var(--text-1); }
    .pill.active {
      background: var(--text-1);
      border-color: var(--text-1);
      color: var(--white);
    }
    .pill-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    /* â”€â”€ List Header â”€â”€ */
    #list-header {
      padding: 14px 20px 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }
    #list-header span {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--text-3);
    }

    /* â”€â”€ Spot List â”€â”€ */
    #spot-list {
      flex: 1;
      overflow-y: auto;
      padding: 4px 12px 32px;
      scrollbar-width: thin;
      scrollbar-color: var(--divider) transparent;
    }
    #spot-list::-webkit-scrollbar { width: 3px; }
    #spot-list::-webkit-scrollbar-thumb { background: var(--divider); border-radius: 3px; }

    /* â”€â”€ Spot Card â”€â”€ */
    .spot-card {
      display: flex;
      align-items: flex-start;
      gap: 13px;
      padding: 14px 10px;
      border-radius: var(--r-md);
      cursor: pointer;
      transition: background var(--dur) var(--ease);
      position: relative;
    }
    .spot-card + .spot-card { border-top: 1px solid var(--divider); margin-top: 0; border-radius: 0; }
    .spot-card:first-child { border-radius: var(--r-md) var(--r-md) 0 0; }
    .spot-card:last-child  { border-radius: 0 0 var(--r-md) var(--r-md); }
    .spot-card:only-child  { border-radius: var(--r-md); }
    .spot-card:hover  { background: var(--off-white); }
    .spot-card.active { background: var(--gold-bg); }

    .card-icon {
      width: 48px; height: 48px;
      border-radius: 11px;
      flex-shrink: 0;
      overflow: hidden;
      background: var(--off-white);
      position: relative;
    }
    .card-icon img {
      width: 100%; height: 100%;
      object-fit: cover;
      display: block;
      transition: opacity .3s;
    }
    .card-icon .icon-fallback {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }
    .card-body { flex: 1; min-width: 0; }
    .card-name {
      font-size: 13.5px;
      font-weight: 600;
      letter-spacing: -.02em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: var(--text-1);
    }
    .card-sub {
      font-size: 11.5px;
      color: var(--text-2);
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .card-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    .card-price {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-2);
    }
    .insider-tag {
      font-size: 9.5px;
      font-weight: 700;
      letter-spacing: .07em;
      text-transform: uppercase;
      color: var(--gold);
      background: var(--gold-bg);
      border: 1px solid rgba(184,148,63,.25);
      padding: 2px 7px;
      border-radius: 999px;
    }
    .card-chevron {
      color: var(--text-3);
      font-size: 14px;
      align-self: center;
      flex-shrink: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* #map rules merged into layout above */

    /* Leaflet attribution styling */
    .leaflet-control-attribution {
      font-size: 9px !important;
      background: rgba(255,255,255,.7) !important;
      backdrop-filter: blur(8px) !important;
    }
    .leaflet-control-zoom a {
      font-family: inherit !important;
    }

    /* Custom marker â€” photo pin */
    .mk-pin {
      width: 46px;
      height: 54px;
      position: relative;
      filter: drop-shadow(0 3px 8px rgba(0,0,0,.28));
    }
    .mk-circle {
      width: 46px; height: 46px;
      border-radius: 50%;
      overflow: hidden;
      border: 2.5px solid #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,.18);
      background: var(--off-white);
      position: relative;
    }
    .mk-circle img {
      width: 100%; height: 100%;
      object-fit: cover;
      display: block;
    }
    .mk-circle .mk-fallback {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    /* triangle tail */
    .mk-tail {
      width: 0; height: 0;
      border-left: 7px solid transparent;
      border-right: 7px solid transparent;
      border-top: 10px solid #fff;
      margin: -1px auto 0;
      display: block;
      filter: drop-shadow(0 2px 3px rgba(0,0,0,.15));
    }
    /* active state ring */
    .mk-pin.active .mk-circle {
      border-color: var(--gold);
      border-width: 3px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DETAIL SHEET â€” floating bottom sheet
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #detail {
      position: fixed;
      left: 380px;   /* sidebar 20px + 340px + 20px gap */
      bottom: 20px;
      width: 380px;
      max-height: calc(100dvh - 40px);
      background: var(--white);
      border-radius: var(--r-xl);
      box-shadow: var(--s-xl);
      border: 1px solid var(--divider);
      z-index: 100;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: translateY(calc(100% + 28px));
      transition: transform .38s var(--ease), left .3s var(--ease);
    }
    #detail.open { transform: translateY(0); }

    /* Drag handle â€” overlaid on hero image */
    .sheet-handle {
      position: absolute;
      top: 10px; left: 50%;
      transform: translateX(-50%);
      width: 36px; height: 4px;
      background: rgba(255,255,255,.7);
      border-radius: 999px;
      z-index: 6;
      pointer-events: none;
    }

    /* Close â€” overlaid on hero image */
    #detail-close {
      position: absolute;
      top: 10px; right: 12px;
      width: 30px; height: 30px;
      border-radius: 50%;
      border: none;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: #fff;
      font-size: 13px;
      transition: background var(--dur) var(--ease);
      z-index: 6;
    }
    #detail-close:hover { background: rgba(0,0,0,.55); }

    /* Sheet content scroll */
    .sheet-scroll {
      overflow-y: auto;
      flex: 1;
      padding-bottom: 40px;
      scrollbar-width: none;
    }
    .sheet-scroll::-webkit-scrollbar { display: none; }

    /* Hero area */
    .sheet-hero {
      text-align: center;
    }
    /* Hero photo â€” full bleed */
    .sheet-hero-img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      display: block;
      background: var(--off-white);
    }
    .sheet-hero-fallback {
      width: 100%;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 64px;
    }
    .sheet-hero-text {
      padding: 16px 20px 0;
    }
    .sheet-name {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -.04em;
      color: var(--text-1);
      line-height: 1.2;
    }
    .sheet-name-jp {
      font-size: 13px;
      color: var(--text-2);
      margin-top: 4px;
      font-weight: 400;
    }
    .sheet-cat-pill {
      display: inline-block;
      margin-top: 10px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
      padding: 4px 12px;
      border-radius: 999px;
      color: var(--white);
    }

    /* Divider */
    .sheet-divider {
      height: 1px;
      background: var(--divider);
      margin: 18px 20px;
    }

    /* Insider tip */
    .sheet-insider {
      margin: 0 20px;
      background: var(--gold-bg);
      border-radius: var(--r-md);
      padding: 14px 16px;
      position: relative;
    }
    .sheet-insider-label {
      font-size: 9.5px;
      font-weight: 700;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .sheet-insider-text {
      font-size: 13px;
      line-height: 1.7;
      color: #5A4315;
      font-weight: 400;
    }

    /* Meta grid */
    .sheet-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 14px 20px 0;
    }
    .meta-card {
      background: var(--off-white);
      border-radius: var(--r-sm);
      padding: 10px 12px;
    }
    .meta-card-label {
      font-size: 9px;
      font-weight: 600;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--text-3);
      margin-bottom: 4px;
    }
    .meta-card-val {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-1);
      line-height: 1.45;
    }

    /* Description */
    .sheet-desc {
      margin: 14px 20px 0;
      font-size: 13px;
      line-height: 1.75;
      color: var(--text-2);
      font-weight: 400;
    }

    /* Tags */
    .sheet-tags {
      margin: 14px 20px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .sheet-tag {
      font-size: 11px;
      font-weight: 500;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--off-white);
      color: var(--text-2);
      border: 1px solid var(--divider);
    }

    /* CTA */
    .sheet-cta {
      margin: 20px 20px 0;
      display: block;
      text-align: center;
      background: var(--text-1);
      color: var(--white);
      font-size: 14px;
      font-weight: 600;
      padding: 14px 20px;
      border-radius: var(--r-md);
      text-decoration: none;
      letter-spacing: -.01em;
      transition: background var(--dur) var(--ease), transform var(--dur) var(--ease);
    }
    .sheet-cta:hover { background: #333; transform: scale(.99); }
    .sheet-cta-sub {
      display: block;
      font-size: 11px;
      font-weight: 400;
      color: rgba(255,255,255,.6);
      margin-top: 2px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE FAB
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #fab {
      display: none;
      position: fixed;
      top: env(safe-area-inset-top, 16px);
      left: 16px;
      z-index: 200;
      width: 42px; height: 42px;
      border-radius: 12px;
      background: rgba(255,255,255,.9);
      backdrop-filter: blur(20px);
      border: 1px solid var(--divider);
      box-shadow: var(--s-md);
      cursor: pointer;
      font-size: 18px;
      align-items: center; justify-content: center;
      color: var(--text-1);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NIGHT MODE LABEL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #night-label {
      position: absolute;
      top: 16px; right: 16px;
      background: rgba(255,255,255,.88);
      backdrop-filter: blur(16px);
      border: 1px solid var(--divider);
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-1);
      box-shadow: var(--s-sm);
      display: flex;
      align-items: center;
      gap: 6px;
      z-index: 5;
      pointer-events: none;
    }
    .night-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: #2D8F4A;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: .6; transform: scale(.85); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE RESPONSIVE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 720px) {

      /* â”€â”€ ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ« â”€â”€ */
      #panel-drag-handle {
        width: 36px; height: 4px;
        background: var(--divider);
        border-radius: 999px;
        margin: 10px auto 4px;
        flex-shrink: 0;
        cursor: grab;
      }

      /* â”€â”€ ãƒ‘ãƒãƒ«æœ¬ä½“: ãƒœãƒˆãƒ ã‚·ãƒ¼ãƒˆã¸å¤‰æ› â”€â”€ */
      #panel {
        position: fixed;
        left: 0; right: 0; bottom: 0;
        top: auto; width: 100%;
        height: 88px;
        border-radius: 20px 20px 0 0;
        padding-bottom: env(safe-area-inset-bottom, 0px);
        /* PC ã® transition ã‚’ä¸Šæ›¸ã (height/border-radius ã®ã¿) */
        transition:
          height .4s cubic-bezier(.4,0,.2,1),
          border-radius .4s cubic-bezier(.4,0,.2,1),
          box-shadow .4s cubic-bezier(.4,0,.2,1);
      }
      #panel.sheet-half {
        height: 52dvh;
        border-radius: 20px 20px 0 0;
        box-shadow: 0 -8px 40px rgba(0,0,0,.12);
      }
      #panel.sheet-full {
        height: 92dvh;
        border-radius: 14px 14px 0 0;
        box-shadow: 0 -12px 48px rgba(0,0,0,.16);
      }

      /* minimized ã‚¯ãƒ©ã‚¹ã¯ãƒ¢ãƒã‚¤ãƒ«ã§ã¯ãƒãƒ¼çŠ¶æ…‹ã¨ã—ã¦æ‰±ã† */
      #panel.minimized {
        width: 100%; height: 88px;
        top: auto; bottom: 0; left: 0; right: 0;
        border-radius: 20px 20px 0 0;
        cursor: default; box-shadow: none;
      }
      #panel.minimized #panel-content { opacity: 1; pointer-events: auto; }
      #panel.minimized #panel-mini    { opacity: 0; pointer-events: none; }

      /* PCå°‚ç”¨è¦ç´ ã‚’éè¡¨ç¤º */
      #panel-mini      { display: none; }
      #sidebar-minimize { display: none; }

      /* ãƒãƒ¼çŠ¶æ…‹ï¼ˆsheet-half/full ã§ãªã„ï¼‰ã§ã¯ä¸€éƒ¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éš ã™ */
      #panel:not(.sheet-half):not(.sheet-full) #header      { display: none; }
      #panel:not(.sheet-half):not(.sheet-full) #search-wrap { display: none; }
      #panel:not(.sheet-half):not(.sheet-full) #list-header { display: none; }
      #panel:not(.sheet-half):not(.sheet-full) #spot-list   { display: none; }
      #panel:not(.sheet-half):not(.sheet-full) #sidebar-topbar {
        padding: 4px 16px 2px;
      }

      /* topbar ã‚¿ãƒƒãƒ—é ˜åŸŸã‚’ç¢ºä¿ */
      #sidebar-topbar { cursor: pointer; min-height: 44px; }

      /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼: ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æœ€é©åŒ– */
      #filters {
        padding: 4px 12px 8px;
        -webkit-overflow-scrolling: touch;
      }
      .pill { padding: 7px 14px; font-size: 13px; min-height: 36px; }

      /* ãƒãƒƒãƒ—å…¨ç”»é¢ */
      #map { width: 100%; }

      /* Leaflet ã‚ºãƒ¼ãƒ ãƒœã‚¿ãƒ³: ãƒãƒ¼ã®ä¸Šã« */
      .leaflet-bottom.leaflet-right { bottom: 100px; }

      /* night-label: å³ä¸Šå›ºå®š */
      #night-label {
        top: 12px; right: 12px;
        font-size: 11px; padding: 5px 10px;
      }

      /* FAB éè¡¨ç¤º */
      #fab { display: none; }

      /* Detail ã‚·ãƒ¼ãƒˆ: ãƒãƒ¼ã®ä¸Šã‹ã‚‰ slide-up */
      #detail {
        left: 0; right: 0; width: 100%; bottom: 0;
        border-radius: 20px 20px 0 0;
        max-height: 82dvh;
        transform: translateY(calc(100% + 20px));
        transition: transform .38s cubic-bezier(.4,0,.2,1);
      }
      #detail.open {
        transform: translateY(0);
        bottom: 88px;
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EMPTY STATE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .empty-state {
      text-align: center;
      padding: 48px 20px;
      color: var(--text-3);
    }
    .empty-state p { font-size: 13px; margin-top: 8px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SECTION GROUP HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .group-label {
      padding: 16px 10px 6px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--text-3);
    }

  </style>
</head>
<body>

<div id="app">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PANEL â€” single element, two states
       Normal: full sidebar  |  Minimized: 44Ã—44 button
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="panel" onclick="handlePanelClick(event)">

    <!-- Mini icon shown when collapsed (PC only) -->
    <div id="panel-mini" aria-label="Open panel" title="Open menu">â˜°</div>

    <!-- Drag handle (mobile only) -->
    <div id="panel-drag-handle" aria-hidden="true"></div>

    <!-- Full content shown when expanded -->
    <div id="panel-content">

      <!-- Top bar: wordmark + minimize -->
      <div id="sidebar-topbar">
        <div class="wordmark" style="margin-bottom:0">
          <span class="wordmark-main" style="font-size:17px">DT Map in Ginza</span>
        </div>
        <button id="sidebar-minimize" onclick="minimizeSidebar(event)" aria-label="Minimize panel" title="Minimize">
          â†
        </button>
      </div>

      <!-- Header -->
      <div id="header">
        <div class="wordmark-sub" style="margin-bottom:6px;font-size:10px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--gold)">Insider Guide</div>
        <p class="header-desc">
          Curated by a local who has walked these streets for over 20 years.
          The bars, clubs, and lounges that Ginza's regulars actually go to.
        </p>
      </div>

      <!-- Search -->
      <div id="search-wrap">
        <div class="search-field">
          <span class="search-icon">âŒ•</span>
          <input id="search" type="text" placeholder="Search venues, vibesâ€¦" oninput="onSearch()" autocomplete="off" />
        </div>
      </div>

      <!-- Category Filter -->
      <div id="filters">
        <div class="pill active" data-cat="all" onclick="setCat('all',this)">All</div>
        <div class="pill" data-cat="bar" onclick="setCat('bar',this)">
          <span class="pill-dot" style="background:var(--c-bar)"></span> Authentic Bar
        </div>
        <div class="pill" data-cat="club" onclick="setCat('club',this)">
          <span class="pill-dot" style="background:var(--c-club)"></span> Club
        </div>
        <div class="pill" data-cat="hostess" onclick="setCat('hostess',this)">
          <span class="pill-dot" style="background:var(--c-hostess)"></span> Hostess Club
        </div>
        <div class="pill" data-cat="lounge" onclick="setCat('lounge',this)">
          <span class="pill-dot" style="background:var(--c-lounge)"></span> Lounge
        </div>
        <div class="pill" data-cat="jazz" onclick="setCat('jazz',this)">
          <span class="pill-dot" style="background:var(--c-jazz)"></span> Jazz Bar
        </div>
        <div class="pill" data-cat="wine" onclick="setCat('wine',this)">
          <span class="pill-dot" style="background:var(--c-wine)"></span> Wine Bar
        </div>
      </div>

      <!-- List Header -->
      <div id="list-header">
        <span id="count-label">All venues</span>
        <span id="count-num">0 spots</span>
      </div>

      <!-- Spot List -->
      <div id="spot-list"></div>

    </div><!-- /panel-content -->
  </div><!-- /panel -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAP
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="map">
    <div id="night-label">
      <span class="night-dot"></span> Ginza Nightlife Map
    </div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DETAIL SHEET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="detail">
  <div class="sheet-handle"></div>
  <button id="detail-close" onclick="closeDetail()" aria-label="Close">âœ•</button>
  <div class="sheet-scroll">
    <div class="sheet-hero">
      <div id="d-hero-img-wrap"></div>
      <div class="sheet-hero-text">
        <div class="sheet-name" id="d-name"></div>
        <div class="sheet-name-jp" id="d-namejp"></div>
        <span class="sheet-cat-pill" id="d-catpill"></span>
      </div>
    </div>

    <div class="sheet-divider"></div>

    <div class="sheet-insider" id="d-insider-wrap">
      <div class="sheet-insider-label">
        <span>âœ¦</span> Insider Tip
      </div>
      <div class="sheet-insider-text" id="d-insider"></div>
    </div>

    <div class="sheet-meta" id="d-meta"></div>

    <div class="sheet-divider"></div>

    <div class="sheet-desc" id="d-desc"></div>

    <div class="sheet-tags" id="d-tags"></div>

    <a class="sheet-cta" id="d-gmaps" target="_blank" rel="noopener">
      Open in Google Maps
      <span class="sheet-cta-sub">Tap for directions</span>
    </a>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SPOT DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
const CAT = {
  bar:     { label: 'Authentic Bar',  color: '#4A3728', bg: '#F5F0EB' },
  club:    { label: 'Club',           color: '#2C2C3E', bg: '#EEEEF5' },
  hostess: { label: 'Hostess Club',   color: '#1A2F4A', bg: '#EBF0F5' },
  lounge:  { label: 'Lounge',         color: '#1C3A2E', bg: '#EBF5F1' },
  jazz:    { label: 'Jazz Bar',       color: '#3B2035', bg: '#F2EBF5' },
  wine:    { label: 'Wine Bar',       color: '#5C1E2D', bg: '#F5EBEE' },
};

const SPOTS = [

  /* â”€â”€â”€ AUTHENTIC BAR â”€â”€â”€ */
  {
    id: 1,
    name: "Star Bar Ginza",
    nameJp: "ã‚¹ã‚¿ãƒ¼ãƒ»ãƒãƒ¼ãƒ»ã‚®ãƒ³ã‚¶",
    cat: "bar",
    emoji: "ğŸ¥ƒ",
    img: "https://tblg.k-img.com/restaurant/images/Rvw/343554/640x640_rect_9099476b87b7daa46010f9e2cc29ba2b.jpg",
    lat: 35.6743, lng: 139.7689,
    address: "B1F, 1-5-13 Ginza, Sankosha Bldg",
    hours: "17:00 â€“ 00:00 (LO 23:30)  Â·  Closed Sun",
    price: "Â¥Â¥Â¥  Cocktails from Â¥1,500 + Â¥1,100 cover",
    english: "Owner Kishi speaks English fluently",
    dresscode: "Smart casual or above",
    insider: "The owner Hisashi Kishi won the World Cocktail Championship in 1996 â€” the first Japanese ever. Ask him to make a drink with the 'Ninja Ice': a perfectly transparent block carved over three days in three freezers at different temperatures. Foreign bar professionals stop here specifically when visiting Tokyo.",
    desc: "Ginza's most internationally celebrated craft cocktail bar. Descend into a black-walled sanctuary of precision and silence. Every detail â€” glass, ice, spirit, temperature â€” is considered. A mandatory stop for anyone who takes cocktails seriously.",
    tags: ["World Championship 1996", "Ninja Ice", "Counter seating", "No loud music"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Star+Bar+Ginza+Tokyo"
  },
  {
    id: 2,
    name: "Ne Plus Ultra",
    nameJp: "ãƒãƒ—ãƒ©ã‚¹ã‚¦ãƒ«ãƒˆãƒ©éŠ€åº§",
    cat: "bar",
    emoji: "ğŸ•¯ï¸",
    img: "https://goetheweb.jp/uploads/2023/09/ne-plus-ultra-01-1200x815.jpg",
    lat: 35.6694, lng: 139.7641,
    address: "B1F, 7-2-11 Ginza, Yokosuka 5th Bldg",
    hours: "17:00 â€“ 02:00  Â·  Closed Sun",
    price: "Â¥Â¥Â¥Â¥  Drinks from Â¥2,500",
    english: "Limited â€” call ahead",
    dresscode: "Formal / Smart",
    insider: "This is technically a members' bar, but solo visitors with genuine interest in vintage spirits are sometimes admitted. Ring the bell and say a local recommended it. The back room holds pre-war old bottles not listed on any public menu. Cuban cigars are all hand-rolled.",
    desc: "Named 'beyond the ultimate' in Spanish. An extremely private bar in Ginza 7-chome specializing in aged vintage spirits and Cuban cigars. One of the most secretive addresses in Japanese nightlife.",
    tags: ["Members preferred", "Vintage old bottles", "Cuban cigars", "Secret"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Ne+Plus+Ultra+Ginza"
  },
  {
    id: 3,
    name: "dunhill BAR",
    nameJp: "ãƒ€ãƒ³ãƒ’ãƒ« ãƒãƒ¼",
    cat: "bar",
    emoji: "ğŸª¶",
    img: "https://tblg.k-img.com/restaurant/images/Rvw/178590/640x640_rect_4886f4f1e4e86189adbc3b9801b9ba0d.jpg",
    lat: 35.6713, lng: 139.7655,
    address: "2Fâ€“3F, 3-9-8 Ginza (inside Dunhill flagship)",
    hours: "Bar: 17:00 â€“ 23:00  Â·  Lunch: 11:30 â€“ 14:00",
    price: "Â¥Â¥Â¥  Cocktails from Â¥2,000",
    english: "Bilingual staff, English menu",
    dresscode: "Smart",
    insider: "One of only two dunhill BARs on Earth â€” London and here. Most visitors only enter the ground-floor shop. Take the elevator to 2F for the counter bar, or 3F for deep leather armchairs and a curated whisky wall. Walk-ins are welcome before 19:00.",
    desc: "Hidden inside the Dunhill Ginza flagship, this bar exists nowhere else in the world except London. A refined British-Japanese sanctuary of aged Scotch, craft cocktails, and afternoon tea. The kind of place that rewards curiosity.",
    tags: ["Only in London & Ginza", "Afternoon tea", "Leather lounge", "Walk-in before 19:00"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=dunhill+BAR+Ginza+Tokyo"
  },
  {
    id: 4,
    name: "Bar Hoshi",
    nameJp: "ãƒãƒ¼ä¿å¿—",
    cat: "bar",
    emoji: "ğŸŒ™",
    img: "https://tblg.k-img.com/restaurant/images/Rvw/94282/640x640_rect_94282105.jpg",
    lat: 35.6730, lng: 139.7665,
    address: "6F, 8-8-7 Ginza",
    hours: "18:00 â€“ 02:00  Â·  Closed Sun",
    price: "Â¥Â¥Â¥  Cocktails from Â¥1,800",
    english: "Basic English â€” gesture-friendly",
    dresscode: "Smart casual",
    insider: "Barman Yuichi Hoshi has won multiple national and international cocktail competitions. Order the signature 'Falling Star' â€” a rum-based creation he's refined for decades. Sit at the counter and let him guide you. He doesn't need you to speak Japanese.",
    desc: "A timeless Ginza oasis where master barman Yuichi Hoshi presides over a beautifully restrained counter. Award-winning cocktails meet quiet contemplation. The antithesis of noisy nightlife â€” come here to drink well and think.",
    tags: ["Award-winning cocktails", "Counter only", "Quiet atmosphere", "Falling Star"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Bar+Hoshi+Ginza+Tokyo"
  },
  {
    id: 5,
    name: "Bar Shake",
    nameJp: "ãƒãƒ¼ ã‚·ã‚§ã‚¤ã‚¯",
    cat: "bar",
    emoji: "ğŸ«—",
    img: "https://tblg.k-img.com/restaurant/images/Rvw/22052/640x640_rect_22052151.jpg",
    lat: 35.6719, lng: 139.7648,
    address: "B1F, Sukiya-dori, Ginza 5-chome",
    hours: "18:00 â€“ 02:00 (Friâ€“Sat until 03:00)",
    price: "Â¥Â¥  Cocktails from Â¥1,200",
    english: "Menu in English available",
    dresscode: "Casual smart",
    insider: "Push open the heavy door and descend. The interior is stripped back to pure atmosphere â€” dark wood, warm light, no distractions. This is where Ginza locals go when they want a serious drink without ceremony. Prices are honest for the quality.",
    desc: "A Sukiya-dori basement bar that has quietly become a favourite of Ginza's in-the-know crowd. No gimmicks, no theatre â€” just exceptional cocktails in an environment designed purely for the pleasure of drinking.",
    tags: ["Basement bar", "Approachable entry", "Ginza locals", "No frills"],
    insider_flag: false,
    gmaps: "https://maps.google.com/?q=Bar+Shake+Ginza+Tokyo"
  },

  /* â”€â”€â”€ HOSTESS CLUB â”€â”€â”€ */
  {
    id: 6,
    name: "Club Chic",
    nameJp: "ã‚¯ãƒ©ãƒ–ãƒãƒƒã‚¯",
    cat: "hostess",
    emoji: "ğŸ¥‚",
    img: "https://satsuei-navi.com/ginza-chick/image/L210_064_ginza-chick_01.jpg",
    lat: 35.6712, lng: 139.7658,
    address: "Ginza 8-chome area (exact floor disclosed at booking)",
    hours: "19:00 â€“ 02:00  Â·  Closed Sun",
    price: "Â¥Â¥Â¥Â¥Â¥  Budget Â¥50,000+/person (incl. bottle)",
    english: "Introduction or booking service recommended",
    dresscode: "Formal â€” suit required",
    insider: "One of Ginza's true high-end clubs, frequented by senior executives and public figures. The interior is extraordinary â€” chandelier-heavy, European grandeur. First-time foreign guests should arrange entry through a concierge or a Japanese business contact who is already a member.",
    desc: "A landmark Ginza hostess club known for impeccable presentation and an exclusive clientele. Multi-room layout with VIP suites. The chandeliers alone are worth the visit. Represents the pinnacle of traditional Ginza club culture.",
    tags: ["VIP rooms", "Business entertainment", "Introduction preferred", "Grand interior"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Club+Chic+Ginza+Tokyo"
  },
  {
    id: 7,
    name: "Club Next Ginza",
    nameJp: "ãƒã‚¯ã‚¹ãƒˆéŠ€åº§",
    cat: "hostess",
    emoji: "âœ¨",
    img: "https://ginza-irodori.com/wp-content/uploads/2024/07/S__65110081_0-1024x768-1.webp",
    lat: 35.6701, lng: 139.7644,
    address: "Ginza 8-chome, Namiki-dori",
    hours: "19:00 â€“ 02:00  Â·  Closed Sun",
    price: "Â¥Â¥Â¥Â¥  From Â¥30,000/person",
    english: "Some English-speaking staff available on request",
    dresscode: "Smart â€” jacket recommended",
    insider: "The most famous name in modern Ginza clubs. Large-format, high energy, and slightly more accessible than traditional members-only clubs. Walk-in possible but booking via their website or phone ensures a better table. Popular for entertaining international business guests.",
    desc: "The definitive modern Ginza hostess club. Namiki-dori's flagship large-venue club that elevated what Ginza nightlife could be. A blend of traditional omotenashi hospitality with a vibrant contemporary atmosphere.",
    tags: ["Namiki-dori", "Large venue", "Online booking available", "Business use"],
    insider_flag: false,
    gmaps: "https://maps.google.com/?q=Club+Next+Ginza+Tokyo"
  },
  {
    id: 8,
    name: "Club Athena",
    nameJp: "ã‚¯ãƒ©ãƒ– ã‚¢ãƒ†ãƒŠ",
    cat: "hostess",
    emoji: "ğŸ›ï¸",
    img: null,
    lat: 35.6708, lng: 139.7660,
    address: "Ginza 7â€“8 chome area",
    hours: "19:00 â€“ 02:00",
    price: "Â¥Â¥Â¥Â¥  From Â¥35,000/person",
    english: "Limited â€” introduction recommended",
    dresscode: "Formal",
    insider: "Four separate floors, each with a different atmosphere â€” a rarity even in Ginza. The VIP private rooms include karaoke and dedicated bathroom. The European-style main floor is the most photogenic room in Ginza nightlife. Worth requesting a floor tour before being seated.",
    desc: "An opulent multi-floor hostess club with distinct atmospheres per floor. The European main room is dramatic; the private suites are discreet. A go-to choice for entertaining guests who want a genuinely memorable evening.",
    tags: ["4 floors", "Private karaoke suites", "European interior", "Full evening experience"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Club+Athena+Ginza+Tokyo"
  },
  {
    id: 9,
    name: "Club Sakurako",
    nameJp: "ã‚¯ãƒ©ãƒ– æ¡œå­",
    cat: "hostess",
    emoji: "ğŸŒ¸",
    img: null,
    lat: 35.6705, lng: 139.7636,
    address: "Near Shimbashi Ginza exit, 4 min walk",
    hours: "19:00 â€“ 01:30",
    price: "Â¥Â¥Â¥Â¥  From Â¥25,000/person",
    english: "Some staff speak conversational English",
    dresscode: "Smart â€” jacket preferred",
    insider: "Known among insiders as the most refined atmosphere without the intimidating price floor of the very top clubs. Simple, understated interior â€” the opposite of flashy. The quality of conversation and service here consistently outperforms much more expensive venues.",
    desc: "A discreet, high-quality hostess club near Shimbashi with a calm, unhurried atmosphere. Less ostentatious than the mega-clubs â€” chosen by guests who value substance over spectacle. A favourite of Ginza veterans.",
    tags: ["Understated elegance", "Shimbashi access", "No-frills pricing", "Veteran favourite"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Club+Sakurako+Ginza+Tokyo"
  },

  /* â”€â”€â”€ LOUNGE â”€â”€â”€ */
  {
    id: 10,
    name: "Magdalena â€” Grand Bach Tokyo Ginza",
    nameJp: "ãƒã‚°ãƒ€ãƒ¬ãƒ¼ãƒŠ",
    cat: "lounge",
    emoji: "ğŸ¹",
    img: "https://tblg.k-img.com/restaurant/images/Rvw/254659/640x640_rect_6f649af24a6f219274b1bd04f15967a2.jpg",
    lat: 35.6697, lng: 139.7700,
    address: "Hotel Grand Bach Tokyo Ginza, Higashi-Ginza",
    hours: "17:00 â€“ 01:00 (Sun until 23:00)",
    price: "Â¥Â¥Â¥  Cocktails from Â¥1,600",
    english: "English menu, bilingual staff",
    dresscode: "Smart casual",
    insider: "Named after Bach's wife Magdalena â€” the entire hotel is themed around the composer. Live classical piano plays on selected evenings. Arrive at 18:30 on a Thursday for the best chance of a performance. The 'Bach Cocktail' is a signature that changes seasonally.",
    desc: "A beautifully designed hotel bar and lounge themed around Johann Sebastian Bach. Classical music plays softly; the interiors are warm and deeply considered. One of the most sophisticated places to open or close an evening in Ginza.",
    tags: ["Classical music", "Hotel bar", "Live piano (selected evenings)", "Bach Cocktail"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Hotel+Grand+Bach+Tokyo+Ginza"
  },
  {
    id: 11,
    name: "Lounge Bar Courage",
    nameJp: "ãƒ©ã‚¦ãƒ³ã‚¸ãƒãƒ¼ ã‚¯ãƒ©ãƒ¼ã‚¸ãƒ¥",
    cat: "lounge",
    emoji: "ğŸŒƒ",
    img: "https://courage-yurakucho.com/wp-content/uploads/2021/12/20211203_top_sub.jpg",
    lat: 35.6740, lng: 139.7610,
    address: "Near Hibiya Station, 1 min walk",
    hours: "18:00 â€“ 02:00  Â·  Closed Sun",
    price: "Â¥Â¥Â¥  From Â¥2,000 cover",
    english: "English menu available",
    dresscode: "Smart casual",
    insider: "The elevator opens directly into the lounge â€” no corridor, no announcement â€” just an immediate reveal of a non-ordinary space. The lighting is perfect. Go on a weeknight and you may have the room almost to yourself. Regulars describe it as 'the adult Ginza that most tourists never find.'",
    desc: "An elegant lounge bar accessible via Hibiya â€” geographically close to Ginza but in a quieter, more residential register. The carefully lit interior rewards slow evenings. Staff are attentive without being intrusive.",
    tags: ["Hibiya access", "Elevator reveal", "Quiet weeknights", "Non-tourist"],
    insider_flag: false,
    gmaps: "https://maps.google.com/?q=Lounge+Bar+Courage+Hibiya+Tokyo"
  },

  /* â”€â”€â”€ JAZZ BAR â”€â”€â”€ */
  {
    id: 12,
    name: "Swing",
    nameJp: "ã‚¹ã‚¦ã‚£ãƒ³ã‚°",
    cat: "jazz",
    emoji: "ğŸ·",
    img: "https://ginzaswing.jp/wp22/wp-content/uploads/slider/cache/09c9e5adc02e6d841ec8d0b8e6c20708/000051main.jpg",
    lat: 35.6726, lng: 139.7672,
    address: "Ginza 5-chome, upper floors",
    hours: "18:00 â€“ 03:00  Â·  Daily",
    price: "Â¥Â¥  Cover Â¥1,000 + drinks from Â¥800",
    english: "Music is universal â€” very welcoming to foreigners",
    dresscode: "Casual to smart",
    insider: "One of the longest-running jazz bars in Ginza â€” live sessions most evenings, recorded vinyl during off-sets. The crowd is older, knowledgeable, and deeply appreciative. Foreign jazz lovers are welcomed with particular warmth. Ask the bartender about the weekly live schedule.",
    desc: "A Ginza jazz institution where serious listeners gather around vinyl and live performance. Dark, intimate, with the haze of decades of good music embedded in the walls. The kind of place that still exists only in Tokyo.",
    tags: ["Live jazz (most nights)", "Vinyl sessions", "Foreign-friendly", "Late nights"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Swing+Jazz+Bar+Ginza+Tokyo"
  },
  {
    id: 13,
    name: "7th",
    nameJp: "ã‚»ãƒ–ãƒ³ã‚¹",
    cat: "jazz",
    emoji: "ğŸº",
    img: null,
    lat: 35.6718, lng: 139.7680,
    address: "Ginza 6â€“7 chome, 7th floor",
    hours: "19:00 â€“ 02:30  Â·  Closed Mon",
    price: "Â¥Â¥  Cover Â¥800 + drinks from Â¥700",
    english: "Staff speaks basic English",
    dresscode: "Casual",
    insider: "Small, high-ceilinged, with a long bar and a small stage in the corner. The name '7th' refers to the musical seventh chord â€” and everything here is built around that richness. When a live trio plays, the acoustics are remarkable for such a small space. Best visited after 21:30.",
    desc: "A compact, high-quality jazz bar on the 7th floor of a Ginza building. Named after the musical seventh chord. Live trio performances on selected evenings in an acoustically considered space. Small enough that every seat is close to the stage.",
    tags: ["7th floor", "Live trio", "Small venue", "Late nights"],
    insider_flag: false,
    gmaps: "https://maps.google.com/?q=7th+Jazz+Bar+Ginza+Tokyo"
  },

  /* â”€â”€â”€ WINE BAR â”€â”€â”€ */
  {
    id: 14,
    name: "Ginza Wine Bar G5",
    nameJp: "éŠ€åº§ãƒ¯ã‚¤ãƒ³ãƒãƒ¼ G5",
    cat: "wine",
    emoji: "ğŸ·",
    img: "https://tblg.k-img.com/restaurant/images/Rvw/344457/640x640_rect_5cff201a5316ada51cc57d6e47b80380.jpg",
    lat: 35.6724, lng: 139.7639,
    address: "5-chome Ginza, 3 min from Exit A1/A2",
    hours: "17:00 â€“ 00:00  Â·  Closed Sun",
    price: "Â¥Â¥Â¥  Glasses from Â¥1,500  Â·  Bottles available",
    english: "Full English wine list",
    dresscode: "Smart casual",
    insider: "The defining feature: they open bottles that would otherwise only be available by the bottle at auction prices. You can order a 10cl pour of a Grand Cru Burgundy or a first-growth Bordeaux. The sommelier â€” a Ginza veteran â€” speaks excellent English and will educate freely if you show interest.",
    desc: "A specialist wine bar offering by-the-glass access to bottles that most Tokyo restaurants reserve for table-service by the bottle. The curated list rotates constantly. A genuine destination for wine lovers who want to taste above their usual budget.",
    tags: ["Grand Cru by the glass", "English sommelier", "Rotating selection", "Small producer focus"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Ginza+Wine+Bar+G5+Tokyo"
  },
  {
    id: 15,
    name: "Enoteca Castello",
    nameJp: "ã‚¨ãƒãƒ†ã‚« ã‚«ã‚¹ãƒ†ãƒƒãƒ­",
    cat: "wine",
    emoji: "ğŸ«™",
    img: null,
    lat: 35.6709, lng: 139.7649,
    address: "Ginza 7-chome, B1F",
    hours: "17:30 â€“ 01:00 (Sat from 16:00)  Â·  Closed Mon",
    price: "Â¥Â¥Â¥  Glasses from Â¥1,200",
    english: "English wine menu, Italian-Japanese staff",
    dresscode: "Casual smart",
    insider: "Italian-focused with a deep cellar of aged Barolo and Brunello. The food pairings â€” antipasti, charcuterie, small pasta plates â€” are excellent and fairly priced. Come here after a hostess club night or before heading into the bar scene. The basement energy is warm and convivial.",
    desc: "A serious Italian wine bar in Ginza's basement register. Deep Italian cellar, good small plates, warm atmosphere. A natural bridge between dinner and nightlife for those who want to keep the evening moving gently.",
    tags: ["Italian cellar", "Barolo & Brunello", "Food pairings", "Basement warmth"],
    insider_flag: false,
    gmaps: "https://maps.google.com/?q=Enoteca+Ginza+Tokyo"
  },

  /* â”€â”€â”€ CLUB â”€â”€â”€ */
  {
    id: 16,
    name: "Club Pasutone",
    nameJp: "ã‚¯ãƒ©ãƒ– ãƒ‘ã‚¹ãƒˆãƒ¼ãƒ³",
    cat: "club",
    emoji: "ğŸ¹",
    img: "https://www.ginzaclub-passtone.com/images/floor/main.jpg",
    lat: 35.6715, lng: 139.7651,
    address: "Ginza central, building disclosed at booking",
    hours: "19:30 â€“ 01:30",
    price: "Â¥Â¥Â¥Â¥  From Â¥30,000/person",
    english: "Limited â€” introduction recommended",
    dresscode: "Formal â€” dark suit",
    insider: "Ginza's only club with a resident grand piano played by a professional pianist â€” not background music, a live performance. The pianist reads the room's mood and adjusts accordingly. When the room is quiet, the music becomes extraordinary. Request a seat near the piano.",
    desc: "A distinguished Ginza club notable for its resident professional grand piano. The musical dimension elevates the atmosphere beyond a conventional hostess venue. Favored by those who appreciate that an evening should have artistic as well as social dimension.",
    tags: ["Live grand piano", "Professional pianist", "Formal setting", "Unique in Ginza"],
    insider_flag: true,
    gmaps: "https://maps.google.com/?q=Club+Pasutone+Ginza+Tokyo"
  },
  {
    id: 17,
    name: "Venice Club",
    nameJp: "ãƒ´ã‚§ãƒ‹ã‚¹ã‚¯ãƒ©ãƒ–",
    cat: "club",
    emoji: "ğŸ°",
    img: "https://ginza-irodori.com/wp-content/uploads/2024/07/S__823607316_0-1024x768-1.webp",
    lat: 35.6706, lng: 139.7638,
    address: "Ginza 8-chome vicinity",
    hours: "19:00 â€“ 02:00",
    price: "Â¥Â¥Â¥Â¥  From Â¥25,000/person",
    english: "Some English-speaking staff on request",
    dresscode: "Smart â€” jacket preferred",
    insider: "The medieval Venetian interior design is genuinely impressive â€” arches, frescoes, the feel of a palazzo. It sounds theatrical but the execution is serious. Foreign guests often respond well to the visual impact. A good choice for international guests who want something that feels unmistakably Japanese in its hospitality but extraordinary in design.",
    desc: "A Ginza club built around a detailed medieval Venetian interior aesthetic. Frescoes, arched ceilings, a European atmosphere grafted onto Japanese omotenashi service. Unusual and memorable â€” the design conversation starter of Ginza nightlife.",
    tags: ["Venetian interior", "Frescoes", "International-friendly", "Design standout"],
    insider_flag: false,
    gmaps: "https://maps.google.com/?q=Venice+Club+Ginza+Tokyo"
  },

];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentCat   = 'all';
let currentQuery = '';
let activeId     = null;
let map, markers = {};

/* â”€â”€ Mobile bottom sheet state â”€â”€ */
let panelState = 'bar'; // 'bar' | 'half' | 'full'
function isMobile() { return window.innerWidth <= 720; }
function setPanelState(state) {
  const panel = document.getElementById('panel');
  panel.classList.remove('sheet-half', 'sheet-full');
  if (state === 'half') panel.classList.add('sheet-half');
  if (state === 'full') panel.classList.add('sheet-full');
  panelState = state;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initMap() {
  map = L.map('map', {
    center: [35.6714, 35.6714 > 100 ? 139.765 : 139.765],
    zoom: 16,
    zoomControl: false,
  });
  map.setView([35.6714, 139.765], 16);

  // Clean, light CartoDB tiles
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> Â© <a href="https://carto.com/">CARTO</a>',
    subdomains: 'abcd',
    maxZoom: 19,
  }).addTo(map);

  L.control.zoom({ position: 'bottomright' }).addTo(map);

  // Close detail when clicking map background
  map.on('click', closeDetail);

  SPOTS.forEach(s => {
    const cfg = CAT[s.cat];
    const imgHtml = s.img
      ? `<img src="${s.img}" alt="${s.name}" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">`
      : '';
    const fallbackStyle = s.img ? 'style="display:none"' : '';
    const icon = L.divIcon({
      className: '',
      html: `
        <div class="mk-pin" id="mkpin-${s.id}">
          <div class="mk-circle" style="border-color:${cfg.color}">
            ${imgHtml}
            <div class="mk-fallback" ${fallbackStyle} style="background:${cfg.bg}">${s.emoji}</div>
          </div>
          <span class="mk-tail" style="border-top-color:${cfg.color}"></span>
        </div>`,
      iconSize: [46, 56],
      iconAnchor: [23, 56],
      popupAnchor: [0, -58],
    });
    const m = L.marker([s.lat, s.lng], { icon })
      .addTo(map)
      .on('click', e => { L.DomEvent.stopPropagation(e); openDetail(s.id); });
    markers[s.id] = m;
  });

  renderList();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function filtered() {
  return SPOTS.filter(s => {
    const matchCat = currentCat === 'all' || s.cat === currentCat;
    const q = currentQuery.toLowerCase().trim();
    const matchQ = !q ||
      s.name.toLowerCase().includes(q) ||
      s.nameJp.includes(q) ||
      s.desc.toLowerCase().includes(q) ||
      s.tags.some(t => t.toLowerCase().includes(q)) ||
      CAT[s.cat].label.toLowerCase().includes(q);
    return matchCat && matchQ;
  });
}

function setCat(cat, el) {
  currentCat = cat;
  document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  syncMarkers();
  renderList();
}

function onSearch() {
  currentQuery = document.getElementById('search').value;
  syncMarkers();
  renderList();
}

function syncMarkers() {
  const visible = new Set(filtered().map(s => s.id));
  SPOTS.forEach(s => {
    if (visible.has(s.id)) markers[s.id]?.addTo(map);
    else if (markers[s.id]) map.removeLayer(markers[s.id]);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER LIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderList() {
  const spots = filtered();
  document.getElementById('count-num').textContent = `${spots.length} spot${spots.length !== 1 ? 's' : ''}`;

  const list = document.getElementById('spot-list');
  if (!spots.length) {
    list.innerHTML = `<div class="empty-state"><div style="font-size:32px">ğŸ”</div><p>No venues match your search.<br>Try a different keyword or category.</p></div>`;
    return;
  }

  // Group by category for readability when showing all
  if (currentCat === 'all' && !currentQuery) {
    const groups = {};
    spots.forEach(s => {
      if (!groups[s.cat]) groups[s.cat] = [];
      groups[s.cat].push(s);
    });
    list.innerHTML = Object.entries(groups).map(([cat, ss]) =>
      `<div class="group-label">${CAT[cat].label}</div>` + ss.map(s => cardHTML(s)).join('')
    ).join('');
  } else {
    list.innerHTML = spots.map(s => cardHTML(s)).join('');
  }
}

function cardHTML(s) {
  const cfg = CAT[s.cat];
  const imgContent = s.img
    ? `<img src="${s.img}" alt="${s.name}" loading="lazy" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
       <div class="icon-fallback" style="display:none;background:${cfg.bg}">${s.emoji}</div>`
    : `<div class="icon-fallback" style="background:${cfg.bg}">${s.emoji}</div>`;
  return `
    <div class="spot-card${s.id === activeId ? ' active' : ''}" id="card-${s.id}" onclick="openDetail(${s.id})">
      <div class="card-icon">${imgContent}</div>
      <div class="card-body">
        <div class="card-name">${s.name}</div>
        <div class="card-sub">${s.nameJp}</div>
        <div class="card-meta">
          <span class="card-price">${s.price.split('  ')[0]}</span>
          ${s.insider_flag ? '<span class="insider-tag">Insider</span>' : ''}
        </div>
      </div>
      <span class="card-chevron">â€º</span>
    </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDetail(id) {
  const s = SPOTS.find(x => x.id === id);
  if (!s) return;
  activeId = id;

  const cfg = CAT[s.cat];

  // Hero image / fallback
  const heroWrap = document.getElementById('d-hero-img-wrap');
  if (s.img) {
    heroWrap.innerHTML = `
      <img class="sheet-hero-img" src="${s.img}" alt="${s.name}"
        onerror="this.outerHTML='<div class=\\'sheet-hero-fallback\\' style=\\'background:${cfg.bg}\\'>${s.emoji}</div>'">`;
  } else {
    heroWrap.innerHTML = `<div class="sheet-hero-fallback" style="background:${cfg.bg}">${s.emoji}</div>`;
  }

  document.getElementById('d-name').textContent    = s.name;
  document.getElementById('d-namejp').textContent  = s.nameJp;

  const pill = document.getElementById('d-catpill');
  pill.textContent = cfg.label;
  pill.style.background = cfg.color;

  document.getElementById('d-insider').textContent = s.insider;

  document.getElementById('d-meta').innerHTML = `
    <div class="meta-card">
      <div class="meta-card-label">Hours</div>
      <div class="meta-card-val">${s.hours}</div>
    </div>
    <div class="meta-card">
      <div class="meta-card-label">Price Range</div>
      <div class="meta-card-val">${s.price}</div>
    </div>
    <div class="meta-card">
      <div class="meta-card-label">English</div>
      <div class="meta-card-val">${s.english}</div>
    </div>
    <div class="meta-card">
      <div class="meta-card-label">Dress Code</div>
      <div class="meta-card-val">${s.dresscode}</div>
    </div>
  `;

  document.getElementById('d-desc').textContent = s.desc;
  document.getElementById('d-tags').innerHTML = s.tags.map(t => `<span class="sheet-tag">${t}</span>`).join('');
  document.getElementById('d-gmaps').href = s.gmaps;

  // ãƒ¢ãƒã‚¤ãƒ«: è©³ç´°ã‚’é–‹ã„ãŸã‚‰ãƒ‘ãƒãƒ«ã‚’ãƒãƒ¼ã«ç¸®å°ã—ã¦ãƒãƒƒãƒ—ã‚’è¦‹ã›ã‚‹
  if (isMobile()) setPanelState('bar');

  document.getElementById('detail').classList.add('open');
  map.flyTo([s.lat, s.lng], 16, { duration: .7, easeLinearity: .4 });

  // Highlight card
  document.querySelectorAll('.spot-card').forEach(c => c.classList.remove('active'));
  const card = document.getElementById(`card-${id}`);
  if (card) { card.classList.add('active'); card.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }

  // Highlight marker pin (gold ring)
  document.querySelectorAll('.mk-pin').forEach(p => p.classList.remove('active'));
  const pin = document.getElementById(`mkpin-${id}`);
  if (pin) pin.classList.add('active');
}

function closeDetail() {
  document.getElementById('detail').classList.remove('open');
  activeId = null;
  document.querySelectorAll('.spot-card').forEach(c => c.classList.remove('active'));
  document.querySelectorAll('.mk-pin').forEach(p => p.classList.remove('active'));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANEL MINIMIZE / RESTORE
   Single #panel element morphs between full sidebar
   and a 44Ã—44 button via CSS width/bottom transitions.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function minimizeSidebar(e) {
  if (e) e.stopPropagation();
  if (isMobile()) { setPanelState('bar'); return; }
  // PC: æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯
  const panel  = document.getElementById('panel');
  const detail = document.getElementById('detail');
  panel.classList.add('minimized');
  setTimeout(() => { detail.style.left = '20px'; }, 200);
}

function restoreSidebar() {
  if (isMobile()) { setPanelState('half'); return; }
  // PC: æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯
  const panel  = document.getElementById('panel');
  const detail = document.getElementById('detail');
  panel.classList.remove('minimized');
  setTimeout(() => { detail.style.left = '380px'; }, 200);
}

function handlePanelClick(e) {
  if (!isMobile()) {
    // PC: minimized ãªã‚‰å¾©å…ƒ
    const panel = document.getElementById('panel');
    if (panel.classList.contains('minimized')) restoreSidebar();
    return;
  }
  // ãƒ¢ãƒã‚¤ãƒ«: topbar / ãƒãƒ³ãƒ‰ãƒ« / ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã‚¿ãƒƒãƒ—ã§æ®µéšå±•é–‹
  const topbar  = document.getElementById('sidebar-topbar');
  const handle  = document.getElementById('panel-drag-handle');
  const filters = document.getElementById('filters');
  const target  = e.target;
  if (!topbar.contains(target) && target !== handle && !filters.contains(target)) return;
  if (panelState === 'bar')       setPanelState('half');
  else if (panelState === 'half') setPanelState('full');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE BOTTOM SHEET â€” SWIPE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initBottomSheetSwipe() {
  if (!isMobile()) return;
  const panel  = document.getElementById('panel');
  const handle = document.getElementById('panel-drag-handle');
  const topbar = document.getElementById('sidebar-topbar');
  let startY = 0, startH = 0;

  function onStart(e) {
    startY = e.touches[0].clientY;
    startH = panel.offsetHeight;
    panel.style.transition = 'none';
  }
  function onMove(e) {
    const dy  = startY - e.touches[0].clientY;
    const max = window.innerHeight * 0.92;
    panel.style.height = Math.max(88, Math.min(max, startH + dy)) + 'px';
  }
  function onEnd(e) {
    panel.style.transition = '';
    panel.style.height = '';
    const dy = startY - e.changedTouches[0].clientY;
    if      (dy >  60) setPanelState(panelState === 'bar'  ? 'half' : 'full');
    else if (dy < -60) setPanelState(panelState === 'full' ? 'half' : 'bar');
    else               setPanelState(panelState); // ã‚¹ãƒŠãƒƒãƒ—ï¼ˆå…ƒã®çŠ¶æ…‹ã‚’ç¶­æŒï¼‰
  }

  [handle, topbar].forEach(el => {
    el.addEventListener('touchstart', onStart, { passive: true });
    el.addEventListener('touchmove',  onMove,  { passive: true });
    el.addEventListener('touchend',   onEnd);
  });
}

window.addEventListener('DOMContentLoaded', () => {
  initMap();
  initBottomSheetSwipe();
});
</script>
</body>
</html>

